{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Negotiate - {{ product.productName }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/negotiation.css' %}">
</head>
<body>
<div class="container my-5">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="col-md-6">
            {% if product.images %}
                <img src="{{ product.images.url }}" class="img-fluid rounded shadow" alt="{{ product.productName }}">
            {% else %}
                <div class="border p-4 text-center">No Image Available</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <h2>{{ product.productName }}</h2>
            <p><strong>Price:</strong> â‚¹{{ product.price }}</p>
            <p><strong>Quantity:</strong> {{ product.quantity }}kg</p>
            <p><strong>Description:</strong><br>{{ product.description }}</p>
            <p><strong>Uploaded At:</strong> {{ product.uploaded_at }}</p>

            {% if negotiation_setting %}
            <div class="mt-3">
                <p><strong>Negotiation Mode:</strong> {{ negotiation_setting.negotiation_type|title }}</p>
                {% if negotiation_setting.negotiation_type == "active" %}
                    <p><strong>Validity:</strong> {{ negotiation_setting.validity_hours }} hour{{ negotiation_setting.validity_hours|pluralize }}</p>
                {% elif negotiation_setting.negotiation_type == "passive" %}
                    <p><strong>Validity:</strong> {{ negotiation_setting.validity_days }} day{{ negotiation_setting.validity_days|pluralize }}</p>
                {% endif %}
            </div>
        {% endif %}
        

            <hr>

            {% if negotiation_expired %}
                <div class="alert alert-danger">This negotiation has expired.</div>
            {% elif max_reached %}
                <div class="alert alert-warning">You have reached the maximum number of 3 messages.</div>
            {% else %}
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="negotiation_message" class="form-label">Send Negotiation Message:</label>
                        <textarea class="form-control" name="negotiation_message" id="negotiation_message" rows="4" placeholder="Type your offer or message here..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-warning">Send Negotiation</button>
                </form>
            {% endif %}

            <hr>
            <button class="btn btn-success mt-2">Add to Cart</button>
            <button class="btn btn-primary mt-2">Buy Now</button>
        </div>
    </div>

    {% if messages_history %}
        <div class="mt-5">
            <h5>Negotiation History</h5>
            <ul class="list-group">
                {% for msg in messages_history %}
                    <li class="list-group-item">
                        <strong>{{ msg.sender.username }}:</strong> {{ msg.message }}
                        <div class="text-muted small">{{ msg.timestamp|date:"M d, Y H:i" }}</div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>

<script src="{% static 'javascript/negotiation.js' %}"></script>
</body>
</html>
